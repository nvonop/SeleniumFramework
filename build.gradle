apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'idea'
apply plugin: 'groovy'

group = 'org.nvonop.selenium.framework'
version = '1.3.2'

repositories {
	// Spock releases are available from Maven Central
	mavenCentral()
	// Spock snapshots are available from the Sonatype OSS snapshot repository
	//maven { url "http://oss.sonatype.org/content/repositories/snapshots/" }
}

dependencies {
	compile "org.codehaus.groovy:groovy-all:2.4.0"
	testCompile "org.spockframework:spock-core:1.0-groovy-2.4"
	compile "org.seleniumhq.selenium:selenium-java:2.+"
	compile group: 'com.google.inject', name: 'guice', version: '3.0'
	compile("org.uncommons:reportng:1.1.2") {
		exclude group: "org.testng", module: "testng"
	}

}

test {
	systemProperties = System.getProperties()
	maxParallelForks = 3
	forkEvery = 1
	systemProperties['BUILD'] = version.toString()
	systemProperties['LOCAL_DRIVER'] = false
	systemProperties['REMOTE_DRIVER'] = false
	systemProperties['SAUCE_DRIVER'] = true
	systemProperties['SAUCE_KEY'] = 'http://'+System.getenv('SAUCE_USERNAME')+':'+System.getenv('SAUCE_ACCESS_KEY')+'@ondemand.saucelabs.com:80/wd/hub'
	systemProperties['GRID_HOST'] = 'localhost'
	systemProperties['GRID_PORT'] = '4444'
	systemProperties['BROWSER'] = System.getenv('BROWSER')
	systemProperties['VERSION'] = System.getenv('VERSION')
	systemProperties['PLATFORM'] = 'WINDOWS'
	systemProperties['TIMEOUT'] = '10'
	systemProperties['TEST_RESULTS_PATH'] = './build/Screenshots'
	systemProperties['APPLICATION_URL'] = "http://selenium-framework.site44.com/controls_page.html"
}

//#######Local gradle test task#######
task testLocal(type: Test){

    systemProperties = System.getProperties()
	maxParallelForks = 3
	forkEvery = 1

//    systemProperties['webdriver.ie.driver'] = "C:\\Automation\\lib\\IEDriverServer.exe"
//    systemProperties['webdriver.chrome.driver'] = "C:\\Automation\\lib\\chromedriver.exe"
	systemProperties['BUILD'] = version.toString()
	systemProperties['LOCAL_DRIVER'] = false
	systemProperties['REMOTE_DRIVER'] = true
	systemProperties['SAUCE_DRIVER'] = false
	systemProperties['SAUCE_KEY'] = 'http://'+System.getenv('SAUCE_USERNAME')+':'+System.getenv('SAUCE_ACCESS_KEY')+'@ondemand.saucelabs.com:80/wd/hub'
	systemProperties['GRID_HOST'] = 'localhost'
	systemProperties['GRID_PORT'] = '4444'
	systemProperties['BROWSER'] = 'chrome'
	systemProperties['VERSION'] = '43'
	systemProperties['PLATFORM'] = 'WINDOWS'
	systemProperties['TIMEOUT'] = '10'
	systemProperties['TEST_RESULTS_PATH'] = './build/Screenshots'
	systemProperties['APPLICATION_URL'] = "http://selenium-framework.site44.com/controls_page.html"
}

task sourcesJar(type: Jar, dependsOn: classes) {
	classifier = 'sources'
	from sourceSets.main.allSource
}

task javadocJar(type: Jar, dependsOn: javadoc) {
	classifier 'javadoc'
	from javadoc.destinationDir
}

artifacts {
	archives sourcesJar
	archives javadocJar
}

jar { exclude('src/org/nvonop/selenium/test') }


uploadArchives {
	repositories {
		mavenDeployer {
			repository (
					url: 'https://api.bintray.com/maven/nvonop/maven/SeleniumFramework'
					) {
						authentication(
								userName: System.getenv('BINTRAY_USERNAME'),
								password: System.getenv('BINTRAY_ACCESS_KEY')
								)
					}
		}
	}
}

